# 16장 국제화

**16장에서 알아볼 사항**
- HTTP가 어떻게 여러 언어 문자들의 체계 및 표준과 상호작용하는지 설명한다.
- HTTP 프로그래머가 올바르게 업무를 수행하는데 도움이 될 수 있도록 전문용어, 기술, 표준의 간략한 개요를 제공한다.
- 언어를 위한 표준 명명 체계와, 어떻게 표준화된 언어 태그가 선택한 콘텐츠를 서술하는지에 대해 설명한다.
- 국제화된 URI의 규칙과 주의사항을 개괄적으로 서술한다.
- 날짜와 그 외 다른 국제화 이슈에 대해 간단히 논의한다.

## 16.1 국제적인 콘텐츠를 다루기 위해 필요한 HTTP 자원
- 서버는 클라이언트에게 문서의 문자와 언어를 HTTP Content-Type charset 매개변수와 Content-Language 헤더를 통해 알려준다.
- 클라이언트는 서버에게 자신이 어떤 차셋 인코딩 알고리즘들과 언어들을 이해하며 그 중 무엇을 선호하는지 말해주기 위해 Accept-Charset 과 Accept-Language 헤더를 보낸다.
```
# 클라이언트 -> 서버
Accept-Language : fr, en; q=0.8
# 매개변수 q=0.8 : 품질인자
# 프랑스어(기본값 1.0)보다 영어(0.8)의 우선순위가 낮다는 것을 의미
Accept-Charset : iso-8859-1, utf-8
```

## 16.2 문자집합과 HTTP
### 1. Charset은 글자를 비트로 변환하는 인코딩이다.
  - 인코딩 : 글자 -> 비트
  - 디코딩 : 비트 -> 글자
  - HTTP Charset : 엔터티 콘텐츠 비트들을 특정 문자 체계의 글자들(인코딩,디코딩)로 바꾸는지 말해줌
  - charset 예시
  ```
  Content-type : text/html; charset=iso-8859-6
  ```
  charset 매개변수는 수신자에게 콘텐츠 비트들을 글자로 디코딩하기 위해 iso-8859-6 아랍 문자집합 디코딩 기법을 사용하라고 하고 있음
  - 해당 예시는 비트 단위의 값을 숫자와 구두점, 그리고 다른 기호들을 포함한 라틴 문자와 아랍 문자로 맵핑하게 될 것임
### 2. 문자집합과 인코딩의 동작
- 비트 -> 문자로 변환
- 문자집합 -> 모양으로 표현(브라우저, 운영체제, 글꼴을 통해 결정)
### 3. 잘못된 차셋은 잘못된 글자를 낳는다.
- 클라이언트가 잘못된 charset 매개변수 사용 시, 깨진 글자가 나올 것
- 브라우저가 본문으로부터 225 (11100001)을 가져온 경우
```
iso-8859-1 (서유럽 문자 코드) 인코딩 양음 악센트가 붙은 소문자 a = á
iso-8859-6 (아랍 코드) : FEH = ف
iso-8859-7 (그리스어) : 알파 = α
iso-8859-8 (히브리어) : BET = ב
```
### 4. 표준화된 MIME 차셋 값
- **MIME차셋** : 특정 문자 인코딩과 특정 코딩된 문자 집합의 결합
- euc-kr 과 UTF-8
  - euc-kr 방식은 원래 영어만을 고려한 1byte 길이의 ASCII 라는 인코딩 방식을 확장하여 한글을 사용할 수 있도록 만든 2byte 길이의 국가 언어 코드
  -**우리나라에서만 쓸 수 있도록 만든 코드**이며, 다른 언어를 사용하는 환경에서는 한글 페이지를 제대로 볼 수 없는 문제가 생길 수 있음
  - 현재는 표준화 및 글로벌 환경을 고려해야 하므로 UTF-8 인코딩 방식을 강력하게 권고하는 바 (JSON 저장할 때, encoding 형식 지정해주면 글짜깨짐 현상 방지 됨)
### 5. Content-Type Charset 헤더와 META 태그
- 웹 서버는 클라이언트에게 MIME 차셋 태그를 charset 매개변수와 함께 Content-Type 헤더에 담아 보낸다.
```
Content-Type : text/html; charset=iso-2022-jp
```
- 만약 나열되지 않았다면, 수신자는 문서의 콘텐츠로부터 문자집합을 추측하려고 시도한다.
  - 받은 HTML 콘텐츠에서 meta 태그 중 HTTP-EQUIV 를 확인한다.
  ```HTML
  <HEAD>
    <META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=iso-2022-jp'>
    <META LANG='jp'>
  </HEAD>
  ```
  - 만일 문서가 HTML 이 아니라면 소프트웨어는 언어와 인코딩에 대한 일반적인 패턴을 찾기 위해 **실제 텍스트를 스케닝**하여 문자 인코딩을 추측한다.
  - 클라이언트가 문자 인코딩을 추측하지 못했다면 **iso-8859-1**로 가정한다.
### 6. Accept-Charset 헤더
  - HTTP 클라이언트가 어떤 문자체계를 지원하는지 서버에게 전송할 때 Accept-Charset 헤더 사용
  - 클라이언트가 지원하는 문자 인코딩 목록을 제공한다.
  ```
  Accept-Charset : iso-8859-1, utf-8
  ```
  - 이 문자 인코딩 구조 중, 어떤 콘텐츠로 변환할지는 서버의 자유이다.


## 16.3 다중언어 문자 인코딩에 대한 지침
**3장의 내용은 문자 인코딩의 상세 설명 부분이며, 관심이 있다면 읽고 넘어가주세요**


## 16.4 언어 태그와 HTTP
- 언어태그 : 언어에 이름을 붙이기 위한 짧고 표준화된 문자열 (표준화된 언어)
  - ex) 영어(en), 독일어(de), 한국어(ko)

### 1. Content-Language 헤더
  - Content-Language : 어떤 언어 사용자를 대상으로 하고있는지 서술함
  ```
  Content-Language : fr
  # 프랑스어 사용자를 대상으로 하고 있다는 의미
  ```
### 2. Accept-Language 헤더
  - HTTP는 클라이언트에게 언어 제약과 선호도를 웹 서버에 전달할 수 있게 해줌
  - 이때 사용하는 것이 Accept-Language
  ```
  Accept-Language : es # 스페인어의 언어태그
  # 스페인어로 된 콘텐츠에 대해 클라이언트의 요청
  ```
### 3. 언어 태그의 종류
  - 일반적인 언어의 종류 ex) es(스페인어)
  - 특정 국가의 언어 ex) en-GB(영국영어)
  - 비표준언어 ex) x-snowboarder-slang (스노우보드 타는 사람)
  - 다른 언어의 변형이 아닌 표준 언어
  - 방언,지방어 등 ex)sgn-US-MA (마서스 비니어드 섬의 수화)

### 4. 서브태그
- 언어 태그는 하이픈으로 분리된 하나 이상의 서브태그로 이루어져 있다.
  ```
  sgn-US-MA
  ```
  - 첫번째 서브태그: 주 서브태그라 불리고, 표준화되어 있다.(언어토큰)
  - 두번째 서브태그: 선택적이고 자신만의 이름 표준을 따른다.(국가토큰)
  - 나머지 서브태그: 8자 이하의 알파벳과 숫자로 이루어짐. 규칙이 따로 없다.


## 16.5 국제화된 URI
  ### 1. 국제적 가독성 vs 의미있는 문자들
  - URI 는 전세계의 모두가 공유하기 쉽게 하기 위해 매우 제한된 문자집합을 사용하였음
    - ex. 기본적인 라틴 알파벳 문자, 숫자, 특수문자
  - 단점
    - 문자집합에 있는 제한으로 비영어권 사람들은 쉽게 사용할 수 없었음
    - 라틴 알파벳을 인식조차 못하는 시민들로 URI를 추상화 패턴으로 기억하는 것은 거의 불가능
  - 그러나, URI 저자들은 리소스 식별자의 가독성과 공유 가능성의 보장이 대부분 의미 있는 문자들로 구성될 수 있도록 하는 것보다 중요하다고 여겼음
  - 그래서 **아스키 문자들의 제한된 집합으로 이루어진 URI**를 갖게 됨
  ### 3. 이스케이핑과 역이스케이핑(unescaping)
  - URI 이스케이프는 예약된 문자나 다른 지원하지 않는 글자들을 안전하게 URI에 삽입할 수 있는 방법을 제공
  - 예약된 문자 : ; / ? : @ & = + $ ,
  - 이스케이프: 퍼센트글자 하나와, 뒤이은 16진수 글자 둘로 이루어진 3글자 문자열 ex. %20 (공백을 나타냄)
  - **URI 해석할 때 주의할 점**
    -  내부적으로 HTTP 애플리케이션은 URI 데이터가 필요할 때만 언이스케이핑 해야 함
    -  이미 언이스케이핑 된 값은 두 번 인코딩 되지 않도록 주의해야 한다.
    - 이스케이프 값은 US-ASCII 코드의 범위(0-127)에 있어야 한다.


## 16.6 기타 고려사항
### 1. 헤더와 명세에 맞지 않는 데이터
  - HTTP 헤더는 반드시 US-ASCII 문자 집합의 글자들로만 이루어져야 한다.
### 2. 날짜
  - HTTP 명세는 올바른 GMT 날짜 형식을 명확히 정의하고 있지만 모든 웹 서버와 클라이언트가 규칙을 따르고 있지 않음을 주의해야 한다.
  - ex) 달을 특정 지역의 언어로 표현한 잘못된 HTTP날짜 헤더를 보내는 서버 등
### 3. 도메인 이름
  - 국제화 문자를 포함하는 도메인 이름을 '국제화 도메인 이름' 이라고 한다.
  - 웹 브라우저는 유니코드 문자열을 호스트 명에서 사용가능한 문자만으로 이루어진 문자열을 변환하는 퓨니코드를 이용하는데, 이를 사용해 사용자가 입력한 다국어로 된 도메인 이름을 알파벳과 숫자 등으로 된 도메인 이름으로 변경한다.
  - ex) 한글.com --(퓨니코드)--> xn--bj0bj06e.com
