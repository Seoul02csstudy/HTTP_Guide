# 요약정리
- 교재중심의 요약정리를 목표로 합니다. (+ 개인적 견해)

### 5.1 다채로운 웹 서버
- 웹 서버는 소프트웨어, 하드웨어(컴퓨터) 둘 모두 가리킨다.
- 역할: 웹 서버는 HTTP요청 받으면 리소스를 클라이언트한테 돌려준다.

### 5.1.1 웹 서버 구현
- 웹 서버는 HTTP, TCP 처리를 통해 구현한다.
- 종류는 대표적으로 다목적 소프트웨어 웹 서버, 임베디드 웹 서버가 있다.

### 5.1.2 다목적 소프트웨어 웹 서버
- 정의: 네트워크에 연결된 표준 컴퓨터 시스템에서 동작한다.
- 그냥 흔히 아는 인터넷 웹 서버
- 임베디드 웹 서버를 제외한 나머지 경우로 생각했다.

### 5.1.3 임베디드 웹 서버
- 정의: 하드웨어(제품)에 내장될 목적으로 만들어진 작은 웹 서버
- 예시: 프린터, 가전제품 등등
- 예시처럼 제품 UI 관리용 소프트웨어로 생각했다.

### 5.2 간단한 펄 웹 서버
- 펄(Perl) 이란? 프로그래밍 언어중 하나.
- type-o-serve라는 펄 프로그램을 사용하여 간단한 웹 서버를 구현할 수 있다.

### 5.3 진짜 웹 서버가 하는 일
- 총 7가지 동작을 한다.
1. 커넥션을 맺는다 -- 클라이언트의 접속을 받아들이거나, 원치 않는 클라이언트라면 닫는다.
2. 요청을 받는다 -- HTTP 요청 메시지를 네트워크로부터 읽어 들인다.
3. 요청을 처리한다 -- 요청 메시지를 해석하고 행동을 취한다.
4. 리소스에 접근한다 -- 메시지에서 지정한 리소스에 접근한다.
5. 응답을 만든다 -- 올바른 헤더를 포함한 HTTP 응답 메시지를 생성한다.
6. 응답을 보낸다 -- 응답을 클라이언트에게 돌려준다.
7. 트랜잭션을 로그로 남긴다 -- 로그파일에 트랜잭션 완료에 대한 기록을 남긴다.

### 5.4 단계 1: 커넥션을 맺는다.
- HTTP 커넥션 관리 기술은 4장을 다시 보세요.

### 5.4.1 새 커넥션 다루기
- 클라이언트가 웹 서버에 TCP 커넥션을 요청하면, 웹 서버는 커넥션을 맺고 맞은편에 어떤 클라이언트가 있는지 확인하고 목록에 추가하여 오가는 데이터를 지켜보기 위한 준비를 한다.
- 보안을 목적으로 웹 서버는 어떤 커넥션이든 마음대로 거절하거나 즉시 닫을 수 있다.

### 5.4.2 클라이언트 호스트 명 식별
- 웹 서버는 '역방향 DNS'를 사용해서 클라이언트 IP주소를 호스트 명으로 변환하도록 설정한다.
- 그러나 해당 방식으로 웹 트랜잭션이 느려질 수 있어서 보통은 꺼둔다.

### 5.4.3 ident를 통해 클라이언트 사용자 알아내기
- 몇몇 웹 서버는 IETF ident 프로토콜을 지원한다.
- 기능: 어떤 사용자 이름이 HTTP 커넥션을 초기화했는지 찾아낼 수 있게 해주므로 웹 서버 로깅에 유용하다.
- 그러나 보안상의 이유로 잘 작동하지는 않는다.

### 5.5 단계 2: 요청을 받는다.
- 커넥션에 데이터가 도착하면, 웹 서버는 네트워크 커넥션에서 그 데이터를 읽어 들이고 파싱하여 요청메시지를 구성한다.
- 즉, 요청을 받으면 해당 요청을 웹 서버가 이해 가능한 언어로 바꾸는 작업을 한다.

### 5.5.1 메시지의 내부 표현
- 몇몇 웹 서버는 요청 메시지를 쉡게 다룰 수 있도록 내부의 자료 구조에 저장한다.

### 5.5.2 커넥션 입력/출력 처리 아키텍처
- 요청을 처리하는 대표적인 구조 방식은 4개가 있다.
1. 단일 스레드 웹 서버
- 한 번에 하나씩 요청을 처리하며 트랜잭션이 완료되면 다음 커넥션이 처리된다.

2. 멀티프로세스와 멀티스레드 웹 서버
- 멀티 프로세스/스레드를 사용하여 웹 서버는 여러 요청을 동시에 처리

3. 다중 아키텍처 웹 서버
- 동시에 여러개의 커넥션을 받고 한 커넥션마다 작은 양을 처리한다. 그 결과 처리된 커넥션이 상태변경으로 돌아가면 그 다음 커넥션의 작은 양을 처리하는 반복작업을 통해서 리소스 낭비를 줄이게 된다.

4. 다중 멀티스레드 웹 서버
- 다중 아키텍처 웹 서버를 동시에 다중으로 돌리는 웹 서버

### 5.6 단계 3: 요청 처리
- 웹 서버는 요청을 받으면 메소드, 리소스, 헤더, 본문을 얻어내서 처리한다.

### 5.7 단계 4: 리소스에 접근한다.
- 웹 서버가 콘텐츠를 클라이언트에게 전달하려면 콘텐츠의 원천을 식별하는 작업을 먼저 한다.

### 5.7.1 Docroot
- 요청 URI를 웹 서버의 파일 시스템 안에 있는 파일 이름으로 사용하는 방식
- 요청 URL: asset/goguma.gif
- 서버 : user/local/asset/goguma.gif
- Docroot: user/local

### 5.7.2 디렉터리 목록
- 웹 서버는 경로가 파일이 아닌 디렉터리를 가리키는 디렉터리 URL에 대한 요청을 받을 수 있고 3가지 행동을 취할 수 있다.
- 에러 반환, '색인 파일' 반환, HTML 페이지 반환
- 보통 요청받으면 자동으로 index.~ 을 찾아서 반환하는것과 같은 원리

### 5.7.3 동적 콘텐츠 리소스 매핑
- 요청 받은 리소스가 동적 리소스일 경우 처리할 수 있다.
- 내가 이해한 내용: 쉽게 생각하면 동적 리소스를 요청하는 URL을 받으면 해당 애플리케이션을 실행시켜서 리소스를 받는다.

### 5.7.4 서버사이드 인클루드(SSI)
- 만약 어떤 리소스가 서버사이드 인클루드를 포함하고 있는 것으로 설정되어 있다면, 서버는 그 리소스의 콘텐츠를 클라이언트에게 보내기 전에 처리한다.

- 아래는 인터넷 검색결과
- 정의: 웹페이지 내에서 다른 파일 내용을 읽어서 삽입하는 방법.
- 내가 이해한 내용: 웹 페이지 만들때 중복적으로 겹치는 부분은 매번 페이지를 만들때 새롭게 만드는게 아니라 겹치는 부분의 페이지를 만들어서 삽입하고 내용만 바꾸는 방식을 사용하는데 이를 서버사이드 인클루드라고 한다.

### 5.7.5 접근제어
- 웹 서버는 각 리소스에 접근 제어를 할당할 수 있다.
- 해당 권한은 12장을 참고해주세요.

### 5.8 단계 5: 응답 만들기
- 올바른 응답 메시지(응답 상태 코드, 응답 헤더, 응답 본문(생성되었다면))를 만든다.

### 5.8.1 응답 엔터티
- 응답 본문이 생성된다면 응답 메시지에는 보통 3개가 포함된다.
- MIME 타입을 서술하는 content-type헤더
- 응답 본문의 길이를 서술하는 content-length헤더
- 실제 응답 본문의 내용

### 5.8.2 MIME 타입 결정하기
- 웹 서버는 응답 본문의 MIME 타입을 결정해야 하는 책임이 있고 MIME 타입과 리소스를 연결하는 대표적인 방식은 4개가 있다.
- MIME 타입이란? https://velog.io/@aerirang647/MIME-type%EC%9D%B4%EB%9E%80
- mime.types: 파일 이름의 확장자 활용
- 매직 타이핑: 파일 패턴에 대한 테이블에서 검색
- 유형 명시: 그냥 웹 서버가 설정
- 유형 협상: 특정 리소스가 여러 종류의 문서 형식에 속하도록 설정할 수 있다.

### 5.8.3 리다이렉션
- 웹 서버는 성공 메시지 대신 리다이렉션 응답을 반환할 수 있고 특정 경우일때 유용하다.
- 영구히 리소스가 옮겨진 경우 - 301 코드
- 임시로 리소스가 옮겨진 경우 - 303, 307코드
- URL 증강 - 303,307코드
- 부하 균형 - 303,307코드
- 친밀한 다른 서버가 있을때 - 303, 307코드
- 디렉터리 이름 정규화 - 빗금이 빠진 경우 추가해서 리다이렉트 한다.

### 5.9 단계 6: 응답보내기
- 서버는 여러 클라이언트에 대한 많은 커넥션을 가질 수 있기 때문에 응답을 보내기전에 커넥션들의 상태를 추적한다.
- 만약 비지속적인 커넥션이라면, 서버는 응답을 보내고 커넥션을 닫을 것이다.
- 지속적인 커넥션의 경우, 특정 경우에 따라 커넥션을 열린 상태로 유지할 것이다.

### 5.10 단계 7: 로깅
- 트랜잭션이 완료되었을 때 웹 서버는 어떻게 수행되었는지 로그를 기록한다.
- 자세한 내용은 21장 참고.